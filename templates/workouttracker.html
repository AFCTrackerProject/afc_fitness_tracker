{% extends "_layout.html" %}

{% block content %}
<h1 class="text-4xl font-bold text-gray-800 mb-4">Workout Log Form</h1>

<form action="{{ url_for('workouttracker') }}" method="post">

  <label for="start-time">Start Time:</label><br>
  <input type="time" id="start-time" name="start-time" required><br><br>

  <label for="end-time">End Time:</label><br>
  <input type="time" id="end-time" name="end-time" required><br><br>

  <!-- Container for dynamically loaded exercises -->
  <div id="exerciseContainer"></div>

  <div class="flex justify-start">
    <div class="w-full" style="max-width: 250px;"> <!-- Smaller max-width -->
      <div class="bg-white shadow-xl rounded px-8 pt-6 pb-8 mb-4"
        style="border-top: 2px solid rgba(0, 0, 0, 0.05); box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.1);">
        <!-- Updated div for vertically listed text buttons -->
        <div class="flex flex-col items-center">
          {% for section in ['Chest', 'Back', 'Arms', 'Legs'] %}
          <button onclick="loadExercises('{{ section|lower }}')"
            class="text-lg font-semibold text-gray-800 bg-white hover:bg-gray-100 py-2 px-4 rounded shadow mb-2 w-full">
            {{ section }} Exercises
          </button>
          {% endfor %}
        </div>
        <!-- Div for exercise display and search functionality -->
        <div class="exercise-display mt-4">
          <!-- Search bar for exercises, initially hidden -->
          <input type="text" id="exerciseSearchInput" placeholder="Search exercises..."
            class="hidden w-full p-2 border border-gray-300 rounded mb-4">
          <!-- Container where exercises will be displayed -->
          <div id="exercisesList">
            <!-- Dynamic content will be loaded here -->
          </div>
        </div>
      </div>
    </div>
  </div>


  <style>
    /* General styles for the exercise display area */
    .exercise-display {
      margin-top: 20px;
    }

    .exercise-container {
      cursor: pointer;
      padding: 10px;
      border-bottom: 1px solid #ccc;
      background-color: #f9f9f9;
      transition: background-color 0.3s, box-shadow 0.3s;
    }

    .exercise-container:hover {
      background-color: #e9e9e9;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .exercise-detail {
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: hidden;
      height: 0;
      transition: height 0.8s ease-in-out, padding 0.8s ease-in-out;
      padding: 0 10px;
    }

    .exercise-container.active .exercise-detail {
      padding: 10px;
    }

    .exercise-container img {
      max-width: 100%;
      height: auto;
    }

    .exercise-container h3 {
      margin: 0;
      color: #333;
      font-size: 18px;
    }

    .exercise-container p {
      color: #666;
      font-size: 16px;
      line-height: 1.4;
    }

    .exercise-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    #exercisesList {
      max-height: 400px;
      /* Adjust based on your design needs */
      overflow-y: auto;
      /* Enables vertical scrolling */
      width: 100%;
      /* Ensures it fills the container */
      border: 1px solid #ccc;
      /* Optional: adds a border for better visual separation */
    }

    .add-exercise-btn {
      padding: 8px 16px;
      background-color: #4CAF50;
      /* Green background */
      color: white;
      /* White text */
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }

    .add-exercise-btn:hover {
      background-color: #45a049;
      /* Darker green background on hover */
    }
  </style>



  <script>
    // Display || API parameters
    const muscleMap = {
      "chest": "chest",
      "back": "back",
      "arms": ["lower arms", "upper arms"],
      "legs": ["lower legs", "upper legs"]
    };

    function loadExercises(muscle) {
      const exercisesContainer = document.querySelector('#exercisesList');
      const searchBar = document.querySelector('#exerciseSearchInput');
      exercisesContainer.innerHTML = '';  // Clear previous exercises
      searchBar.classList.remove('hidden');  // Show the search bar

      const apiMuscles = muscleMap[muscle.toLowerCase()];
      if (Array.isArray(apiMuscles)) {
        apiMuscles.forEach(apiMuscle => {
          fetchExerciseData(apiMuscle);
        });
      } else {
        fetchExerciseData(apiMuscles);
      }
    }

    function fetchExerciseData(apiMuscle) {
      fetch('/exercises/' + apiMuscle)
        .then(response => response.json())
        .then(data => {
          console.log(data);  // Log the data to inspect its structure
          processExerciseData(apiMuscle, data);
        })
        .catch(error => {
          console.error('Error:', error);
        });
    }

    function processExerciseData(muscle, data) {
      const exercisesContainer = document.querySelector('#exercisesList');
      let htmlContent = `<h2 style="text-transform: capitalize; font-size: 24px; font-weight: bold; text-align: center; margin-bottom: 20px;">${muscle} Exercises</h2>`;
      data.exercises.forEach(exercise => {
        const gifUrl = exercise.gifUrl || '/static/images/placeholder.gif'; // Use a placeholder if no GIF is provided

        htmlContent += `
    <div class="exercise-container">
        <h3><strong>${toTitleCase(exercise.name)}</strong></h3>
        <div class="exercise-detail">
            <img src="${gifUrl}" alt="Exercise GIF" style="display: block; margin-left: auto; margin-right: auto; height: auto; border: 2px solid black; margin-bottom: 20px;">
        </div>
        <button type="button" class="add-exercise-btn">Add</button>
    </div>
`;
      });
      exercisesContainer.innerHTML = htmlContent;
      setupExerciseContainerToggle(); // Setup functionality for showing and hiding details
    }


    function toTitleCase(str) {
      return str.replace(/\w\S*/g, function (txt) {
        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
      });
    }

    function setupExerciseContainerToggle() {
      document.querySelectorAll('.exercise-container').forEach(container => {
        // Listen for clicks on the container, but not on the button
        container.addEventListener('click', function (event) {
          if (event.target.classList.contains('add-exercise-btn')) {
            return; // If the "Add" button was clicked, do nothing
          }
          const detail = this.querySelector('.exercise-detail');
          if (detail.style.height && detail.style.height !== '0px') {
            detail.style.height = '0px'; // Collapse the panel
          } else {
            detail.style.height = detail.scrollHeight + 'px'; // Expand the panel
          }
        });
      });
    }

    // Prevent the click on the "Add" button from propagating
    document.querySelectorAll('.add-exercise-btn').forEach(button => {
      button.addEventListener('click', function (event) {
        event.stopPropagation(); // Stop the event from bubbling up to the parent
        // Add additional functionality for what happens when "Add" is clicked
      });
    });


    document.getElementById('exerciseSearchInput').addEventListener('input', function (e) {
      const searchValue = e.target.value.toLowerCase();
      const exerciseElements = document.querySelectorAll('.exercise-container');
      exerciseElements.forEach(el => {
        const title = el.querySelector('h3').textContent.toLowerCase();
        if (title.includes(searchValue)) {
          el.style.display = '';
        } else {
          el.style.display = 'none';
        }
      });
    });
  </script>


  <input type="submit" value="Submit">
</form>

{% endblock %}