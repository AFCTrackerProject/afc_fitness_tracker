{% extends "_layout.html" %}

{% block content %}
<div class="canvas-paper"></div>
<div class="canvas-paper">
    <div class="w-full py-24 px-6 text-center">
        <h1 class="text-4xl font-bold text-gray-800 mb-4">Workouts</h1>
        <p class="text-gray-600">Here you will find a list of exercises!</p>
        <img src="\static\images\workout.png" class="mx-auto block mt-4 w-64 h-64 object-cover">
    </div>
</div>

<div class="flex justify-center items-center">
    <div class="w-full max-w-7xl">
        <div class="bg-white shadow-xl rounded px-8 pt-6 pb-8 mb-4"
            style="border-top: 2px solid rgba(0, 0, 0, 0.05); box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.1);">
            <div class="flex">
                {% for section in ['Chest', 'Back', 'Arms', 'Legs'] %}
                <a onclick="loadExercises('{{ section|lower }}')" class="cursor-pointer w-full max-w-80 mr-4">
                    <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                        <div class="border-b border-gray-200 pb-4 mb-4">
                            <div class="flex items-center">
                                <img src="\static\images\{{ section|lower }}.png" class="w-16 h-16 object-cover mr-4">
                                <div>
                                    <h3 class="text-lg font-semibold mb-2">{{ section }}</h3>
                                    <p class="text-gray-600">List of {{ section }} Exercises</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
            <!-- Container to display the fetched exercise data -->
            <div class="exercise-display mt-4">
                <!-- Dynamic content will be loaded here -->
            </div>
        </div>
    </div>
</div>

<style>
    /* General styles for the exercise display area */
    .exercise-display {
        margin-top: 20px;
    }

    /* Style for each exercise container (clickable header) */
    .exercise-container {
        cursor: pointer;
        padding: 10px;
        border-bottom: 1px solid #ccc;
        background-color: #f9f9f9;
        transition: background-color 0.3s, box-shadow 0.3s;
    }

    .exercise-container:hover {
        background-color: #e9e9e9;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .exercise-detail {
        overflow: hidden;
        height: 0;
        transition: height 0.8s ease-in-out, padding 0.8s ease-in-out;
        padding: 0 10px;
    }

    .exercise-container.active .exercise-detail {
        padding: 10px;
    }


    /* Styling for images to make sure they fit well in the container */
    .exercise-container img {
        max-width: 100%;
        height: auto;
    }

    /* Headings and paragraph styling within the exercise detail */
    .exercise-container h3 {
        margin: 0;
        /* Removes margin for a tighter look */
        color: #333;
        font-size: 18px;
        /* Slightly larger font for visibility */
    }

    .exercise-container p {
        color: #666;
        font-size: 16px;
        line-height: 1.4;
    }
</style>

<script>
    // Display || API parameters
    const muscleMap = {
        "chest": "chest", // Holds 1 value
        "back": "back", // Holds 1 value
        "arms": ["lower arms", "upper arms"], // Array holding multiple values
        "legs": ["lower legs", "upper legs"]  // Array holding multiple values
    };


    function loadExercises(muscle) {
        const exercisesContainer = document.querySelector('.exercise-display');
        exercisesContainer.innerHTML = '';  // Clear the previous exercises
        const apiMuscles = muscleMap[muscle.toLowerCase()];  // Retrieves the correct API parameter(s)

        if (Array.isArray(apiMuscles)) {
            apiMuscles.forEach(apiMuscle => {
                fetchExerciseData(apiMuscle);  // Handle each muscle part separately
            });
        } else {
            fetchExerciseData(apiMuscles);  // Handle single muscle part
        }
    }


    function fetchExerciseData(apiMuscle) {
        fetch('/exercises/' + apiMuscle)
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Network response was not ok for ' + apiMuscle);
                }
            })
            .then(data => {
                processExerciseData(apiMuscle, data); // Function to process and display data
            })
            .catch(error => {
                console.error('Error loading exercises for ' + apiMuscle + ':', error);
                alert('Failed to load exercises for ' + apiMuscle + '. Please check the console for more details.');
            });
    }

    function processExerciseData(muscle, data) {
        const exercisesContainer = document.querySelector('.exercise-display');
        let htmlContent = `<h2 style="font-weight: bold; font-size: 24px;">${muscle.charAt(0).toUpperCase() + muscle.slice(1)} Exercises</h2>`;

        data.exercises.forEach(exercise => {
            const titleCasedName = exercise.name.replace(/\w\S*/g, function (txt) {
                return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
            });

            htmlContent += `
            <div class="exercise-container">
                <h3><strong>${titleCasedName}</strong></h3>
                <div class="exercise-detail">
                    <img src="${exercise.gifUrl}" alt="${titleCasedName}" style="max-width: 100%; height: auto;">
                    <p>${exercise.instructions || 'No instructions provided.'}</p>
                </div>
            </div>
        `;
        });

        exercisesContainer.innerHTML = htmlContent;

        document.querySelectorAll('.exercise-container').forEach(container => {
            container.addEventListener('click', function () {
                const detail = this.querySelector('.exercise-detail');
                if (detail.style.height) {
                    detail.style.height = null; // Close the panel by setting the height to null
                } else {
                    const fullHeight = detail.scrollHeight + 10; // Add an extra 10px to account for margins
                    detail.style.height = fullHeight + "px"; // Set the height dynamically
                }
                this.classList.toggle('active'); // Toggle the 'active' class to handle any styling changes
            });
        });
    }


    document.addEventListener("DOMContentLoaded", function () {
        const btn = document.querySelector(".mobile-menu-button");
        const menu = document.querySelector(".mobile-menu");

        if (btn && menu) {
            btn.addEventListener("click", () => {
                menu.classList.toggle("hidden");
            });
        } else {
            console.error("Menu button or mobile menu not found.");
        }
    });
</script>

{% endblock %}